<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Create Workout</title>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>
<header>
    <h1>Create Workout</h1>
    <nav>
        <a href="index.html">Home</a>
        <a href="create.html">Create Workout</a>
        <a href="choose.html">Choose Workout</a>
    </nav>
</header>
<div class="container">
    <label>Name: <input type="text" id="routineName"></label>

    <div class="inputs">
        <input type="text" id="exName" placeholder="Exercise name">
        <input type="number" id="exReps" placeholder="Reps" min="0">
        <input type="number" id="exWeight" placeholder="Weight" min="0" step="0.1">
        <input type="number" id="exSets" placeholder="Sets" min="1" value="1">
        <button id="addExercise">Add Exercise</button>
    </div>

    <div class="inputs">
        <input type="number" id="restSeconds" placeholder="Rest seconds" min="0" value="30">
        <button id="addRest">Add Rest Set</button>
    </div>

    <ul id="exerciseList" class="list"></ul>
    <button id="saveRoutine">Save Routine</button>
    <button id="deleteRoutine" style="display:none">Delete Routine</button>
</div>
<script src="app.js"></script>
<script>
const params = new URLSearchParams(location.search);
const editId = params.get('id');
let exercises = [];
let editing = false;

if (editId) {
    const found = routines.find(r => r.id === editId);
    if (found) {
        editing = true;
        document.getElementById('routineName').value = found.name;
        exercises = JSON.parse(JSON.stringify(found.exercises));
        document.getElementById('deleteRoutine').style.display = 'inline-block';
    }
}

function renderList() {
    const list = document.getElementById('exerciseList');
    list.innerHTML = '';
    exercises.forEach((ex, idx) => {
        const li = document.createElement('li');
        li.draggable = true;
        li.dataset.idx = idx;
        if (ex.restSet) {
            li.textContent = `Rest - ${ex.rest}s`;
        } else {
            li.textContent = `${ex.type} - ${ex.sets}x${ex.reps} @ ${ex.weight}kg`;
        }
        li.addEventListener('dragstart', drag);
        li.addEventListener('dragover', allowDrop);
        li.addEventListener('drop', drop);
        list.appendChild(li);
    });
}

function drag(ev) { ev.dataTransfer.setData('text', ev.target.dataset.idx); }
function allowDrop(ev) { ev.preventDefault(); }
function drop(ev) {
    ev.preventDefault();
    const from = +ev.dataTransfer.getData('text');
    const to = +ev.target.dataset.idx;
    const item = exercises.splice(from, 1)[0];
    exercises.splice(to, 0, item);
    renderList();
}

document.getElementById('addExercise').onclick = () => {
    const type = document.getElementById('exName').value.trim();
    const reps = parseInt(document.getElementById('exReps').value, 10) || 0;
    const weight = parseFloat(document.getElementById('exWeight').value) || 0;
    const sets = parseInt(document.getElementById('exSets').value, 10) || 1;
    if (type) {
        exercises.push({type, sets, reps, weight, rest:0});
        document.getElementById('exName').value = '';
        document.getElementById('exReps').value = '';
        document.getElementById('exWeight').value = '';
        document.getElementById('exSets').value = '1';
        renderList();
    }
};

document.getElementById('addRest').onclick = () => {
    const rest = parseInt(document.getElementById('restSeconds').value,10) || 0;
    exercises.push({type:'Rest', sets:1, reps:0, weight:0, rest, restSet:true});
    renderList();
};

document.getElementById('saveRoutine').onclick = () => {
    const name = document.getElementById('routineName').value || 'Routine';
    const routine = {id: editing ? editId : createId(), name, exercises};
    saveRoutine(routine);
    window.location.href = 'index.html';
};

document.getElementById('deleteRoutine').onclick = () => {
    if(editing && confirm('Delete this routine?')) {
        routines = routines.filter(r => r.id !== editId);
        save('routines', routines);
        window.location.href = 'index.html';
    }
};

renderList();
</script>
</body>
</html>
