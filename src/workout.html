<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Workout</title>
    <link rel="stylesheet" href="style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
</head>
<body>
<header>
    <h1>Workout</h1>
    <nav>
        <a href="index.html">Home</a>
        <a href="create.html">Create Workout</a>
        <a href="choose.html">Choose Workout</a>
    </nav>
</header>
<div class="container">
    <h2 id="routineTitle"></h2>
    <div id="currentExercise"></div>
    <button id="doneBtn">Done</button>
</div>
<script src="app.js"></script>
<script>
const params = new URLSearchParams(location.search);
const id = params.get('id');
const routine = routines.find(r => r.id === id);
const titleEl = document.getElementById('routineTitle');
const currentEl = document.getElementById('currentExercise');
const doneBtn = document.getElementById('doneBtn');

let index = 0;
let startTime = Date.now();
let records = [];
let exerciseStart = startTime;

function showExercise() {
    if (!routine || index >= routine.exercises.length) {
        finish();
        return;
    }
    const ex = routine.exercises[index];
    titleEl.textContent = routine.name;
    if (ex.restSet) {
        currentEl.innerHTML = `<h3>Rest</h3><p>Rest for ${ex.rest}s</p>`;
        doneBtn.textContent = 'Next';
    } else {
        currentEl.innerHTML = `<h3>${ex.type}</h3>` +
            `<p>Sets: ${ex.sets} Reps: <input type='number' id='reps' value='${ex.reps}'>`+
            ` Weight: <input type='number' id='weight' value='${ex.weight}'></p>`;
        doneBtn.textContent = 'Done';
    }
}

doneBtn.onclick = () => {
    const ex = routine.exercises[index];
    let reps = 0;
    let weight = 0;
    if (!ex.restSet) {
        reps = parseInt(document.getElementById('reps').value,10);
        weight = parseFloat(document.getElementById('weight').value);
    }
    const now = Date.now();
    records.push({type:ex.type,reps,weight,start:exerciseStart,end:now,rest:ex.rest});
    index++;
    exerciseStart = Date.now();
    if (index < routine.exercises.length) {
        showExercise();
    } else {
        finish();
    }
};

function finish() {
    const totalTime = Date.now() - startTime;
    addWorkoutLog({routineId:routine.id,date:new Date().toISOString(),records,totalTime});
    window.location.href = 'summary.html';
}

showExercise();
</script>
</body>
</html>
